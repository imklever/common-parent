<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.isoftstone.common.mongobackup.mapper.TempAppearedLogDtoMapper" >
  <resultMap id="BaseResultMap" type="com.isoftstone.common.mongobackup.domain.mysql.TempAppearedLogDto" >
    <result column="face_id" property="faceId" jdbcType="VARCHAR" />
    <result column="device_type" property="deviceType" jdbcType="VARCHAR" />
    <result column="max_appeared_time" property="maxAppearedTime" jdbcType="DECIMAL" />
  </resultMap>
  <insert id="insert" parameterType="com.isoftstone.common.mongobackup.domain.mysql.TempAppearedLogDto" >
    insert into jd_temp_appeared_log (face_id, device_type, max_appeared_time
      )
    values (#{faceId,jdbcType=DECIMAL}, #{deviceType,jdbcType=VARCHAR}, #{maxAppearedTime,jdbcType=DECIMAL}
      )
  </insert>
  
  <delete id="deleteAll">
    delete from jd_temp_appeared_log
  </delete>
  <select id="selectByType" resultMap="BaseResultMap" parameterType="java.lang.String">
    SELECT face_id,device_type,MAX(appeared_time) AS max_appeared_time 
    FROM jd_log_collection where unit_id = #{unitId,jdbcType=VARCHAR}
    GROUP BY face_id,device_type
  </select>
  <select id="selectByDate" resultMap="BaseResultMap" >
    SELECT face_id,device_type,MAX(appeared_time) AS max_appeared_time 
    FROM jd_log_collection 
    where
     unit_id = #{unitId,jdbcType=VARCHAR}
     AND appeared_date=#{appearedDate,jdbcType=VARCHAR}
     AND appeared_hour  <![CDATA[ <= ]]> #{appearedHour,jdbcType=VARCHAR}
    GROUP BY face_id,device_type
  </select>
  <insert id="insertBatch">
    insert into jd_temp_appeared_log (face_id, device_type, max_appeared_time)
     values 
     <foreach collection ="list" item="dto" separator =",">
     (#{dto.faceId,jdbcType=VARCHAR}, #{dto.deviceType,jdbcType=VARCHAR}, #{dto.maxAppearedTime,jdbcType=DECIMAL})
    </foreach > 
  </insert>

</mapper>