<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.isoftstone.common.mongobackup.mapper.FaceLogCollectionDtoMapper" >
  <resultMap id="BaseResultMap" type="com.isoftstone.common.jd.FaceLogCollectionDto" >
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="face_id" property="faceId" jdbcType="VARCHAR" />
    <result column="device" property="device" jdbcType="VARCHAR" />
    <result column="appeared_time" property="appearedTime" jdbcType="DECIMAL" />
    <result column="image" property="image" jdbcType="VARCHAR" />
    <result column="device_type" property="deviceType" jdbcType="INTEGER" />
    <result column="appeared_format_time" property="appearedFormatTime" jdbcType="VARCHAR" />
    <result column="appeared_date" property="appearedDate" jdbcType="VARCHAR" />
    <result column="appeared_hour" property="appearedHour" jdbcType="VARCHAR" />
    <result column="appeared_minute" property="appearedMinute" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, face_id, device, appeared_time, image,device_type,unit_id,appeared_format_time,appeared_date,appeared_hour,appeared_minute
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from jd_log_collection
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <select id="selectOne" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from jd_log_collection ORDER BY appeared_time LIMIT 1
  </select>
  <select id="selectLogDates" resultMap="BaseResultMap">
     SELECT jc.unit_id,jc.appeared_date,jc.appeared_hour
	  FROM jd_log_collection jc 
	  LEFT JOIN jd_face_id_collection fc ON jc.face_id=fc.face_id  
	  WHERE jc.unit_id=#{unitId,jdbcType=VARCHAR} AND fc.unit_id=#{unitId,jdbcType=VARCHAR}
     GROUP BY jc.appeared_date,jc.appeared_hour ORDER BY appeared_date,appeared_hour
  </select>
   <select id="selectByTime" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from jd_log_collection 
    where appeared_time <![CDATA[ <= ]]> #{endTime,jdbcType=VARCHAR} and capture_time <![CDATA[ >= ]]> #{startTime,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from jd_log_collection
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <delete id="deleteAll">
    delete from jd_log_collection
  </delete>
  <delete id="deleteByDate" parameterType="java.lang.String">
    delete from jd_log_collection where appeared_date <![CDATA[ <= ]]>  #{appearedDate,jdbcType=VARCHAR}
  </delete>
   <delete id="deleteFromStartToEnd">
    delete from jd_log_collection where appeared_time <![CDATA[ <= ]]> #{endTime,jdbcType=VARCHAR} and appeared_time <![CDATA[ >= ]]> #{startTime,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.isoftstone.common.jd.FaceLogCollectionDto" >
    insert into jd_log_collection (id, face_id, device, 
      appeared_time, image,device_type,unit_id,appeared_format_time,appeared_date,appeared_hour,appeared_minute)
    values (#{id,jdbcType=VARCHAR}, #{faceId,jdbcType=VARCHAR}, #{device,jdbcType=VARCHAR}, 
      #{appearedTime,jdbcType=DECIMAL}, #{image,jdbcType=VARCHAR}, #{deviceType,jdbcType=VARCHAR}
      , #{unitId,jdbcType=VARCHAR}, #{appearedFormatTime,jdbcType=VARCHAR}, #{appearedDate,jdbcType=VARCHAR}
      , #{appearedHour,jdbcType=VARCHAR}, #{appearedMinute,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.isoftstone.common.jd.FaceLogCollectionDto" >
    update jd_log_collection
    set face_id = #{faceId,jdbcType=VARCHAR},
      device = #{device,jdbcType=VARCHAR},
      appeared_time = #{appearedTime,jdbcType=DECIMAL},
      image = #{image,jdbcType=VARCHAR},
      device_type=#{dto.deviceType,jdbcType=VARCHAR},
      unit_id=#{dto.unitId,jdbcType=VARCHAR}
    where id = #{id,jdbcType=VARCHAR}
  </update>
    <insert id="insertBatch">
    insert into jd_log_collection (id, face_id,  device, appeared_time, image,device_type,unit_id,appeared_format_time,appeared_date,appeared_hour,appeared_minute
      ) values
     <foreach collection ="list" item="dto" separator =",">
     (#{dto.id,jdbcType=VARCHAR}, #{dto.faceId,jdbcType=VARCHAR}, #{dto.device,jdbcType=VARCHAR}, 
      #{dto.appearedTime,jdbcType=DECIMAL}, #{dto.image,jdbcType=VARCHAR}, #{dto.deviceType,jdbcType=VARCHAR},
      #{dto.unitId,jdbcType=VARCHAR}, #{dto.appearedFormatTime,jdbcType=VARCHAR}, #{dto.appearedDate,jdbcType=VARCHAR}
      , #{dto.appearedHour,jdbcType=VARCHAR}, #{dto.appearedMinute,jdbcType=VARCHAR}
      )  
    </foreach > 
  </insert>
</mapper>